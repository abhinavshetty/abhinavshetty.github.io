"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[845],{3845:(U,h,a)=>{a.r(h),a.d(h,{CollectionModule:()=>H});var c=a(177),C=a(4341),g=a(3383),p=a(1141),m=a(563),f=a(9998),_=a(2242),D=a(981),R=a(8833),F=a(1570),r=a(4945),v=a(2365),d=a(5779),T=a(3695),b=a(1562),S=a(6121),t=a(4438);const u=S.K.apiUrl+"/api/sale",I={headers:new b.Lr({"Content-Type":"application/json"})};let y=(()=>{class n{constructor(e){this.http=e}getSalesDueIn15Days(){return this.http.get(u)}getOverdueSales(){return this.http.get(u+"/late")}getInvoiceForSale(e){return this.http.post(u+"/invoice",e,I)}static{this.\u0275fac=function(o){return new(o||n)(t.KVO(b.Qq))}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac})}}return n})();var N=a(5945);function j(n,l){if(1&n&&(t.j41(0,"div")(1,"h4"),t.EFF(2),t.k0s(),t.j41(3,"h4"),t.EFF(4),t.k0s(),t.j41(5,"h4"),t.EFF(6),t.k0s(),t.j41(7,"h4"),t.EFF(8),t.k0s(),t.j41(9,"h4"),t.EFF(10),t.k0s()()),2&n){const e=t.XpG(3);t.R7$(2),t.SpI("East : INR ",e.dueByRegionToday.EAST,""),t.R7$(2),t.SpI("West : INR ",e.dueByRegionToday.WEST,""),t.R7$(2),t.SpI("North : INR ",e.dueByRegionToday.NORTH,""),t.R7$(2),t.SpI("South : INR ",e.dueByRegionToday.SOUTH,""),t.R7$(2),t.SpI("Others : INR ",e.dueByRegionToday["ALL INDIA"],"")}}function E(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",10)(1,"span",11),t.nrm(2,"i",12),t.j41(3,"input",13),t.bIt("input",function(i){t.eBV(e),t.XpG();const s=t.sdS(4),M=t.XpG(2);return t.Njj(M.onGlobalFilter(s,i))}),t.k0s()(),t.j41(4,"button",14),t.bIt("click",function(){t.eBV(e),t.XpG();const i=t.sdS(4);return t.Njj(i.exportCSV())}),t.k0s()()}}function G(n,l){if(1&n&&(t.j41(0,"th"),t.EFF(1),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.SpI(" ",e.header," ")}}function $(n,l){if(1&n&&(t.j41(0,"tr"),t.DNE(1,G,2,1,"th",15),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.Y8G("ngForOf",e)}}function O(n,l){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const e=t.XpG().$implicit,o=t.XpG().$implicit;t.R7$(),t.JRh(o[e.field])}}function k(n,l){if(1&n){const e=t.RV6();t.j41(0,"p-button",17),t.bIt("onClick",function(){t.eBV(e);const i=t.XpG(2).$implicit,s=t.XpG(3);return t.Njj(s.showInvoice(i))}),t.k0s()}if(2&n){const e=t.XpG().$implicit,o=t.XpG().$implicit;t.Y8G("label",o[e.field])("link",!0)}}function B(n,l){if(1&n&&(t.j41(0,"td"),t.DNE(1,O,2,1,"span",5)(2,k,1,2,"p-button",16),t.k0s()),2&n){const e=l.$implicit,o=t.XpG(4);t.R7$(),t.Y8G("ngIf",!o.isInvoiceNo(e.field)),t.R7$(),t.Y8G("ngIf",o.isInvoiceNo(e.field))}}function P(n,l){if(1&n&&(t.j41(0,"tr"),t.DNE(1,B,3,2,"td",15),t.k0s()),2&n){const e=l.columns;t.R7$(),t.Y8G("ngForOf",e)}}function X(n,l){if(1&n&&(t.j41(0,"h2"),t.EFF(1),t.k0s(),t.DNE(2,j,11,5,"div",5),t.j41(3,"p-table",6,0),t.DNE(5,E,5,0,"ng-template",7)(6,$,2,1,"ng-template",8)(7,P,2,1,"ng-template",9),t.k0s()),2&n){const e=t.XpG().$implicit,o=t.XpG();t.R7$(),t.SpI("Total due to collect today : INR ",o.dueToday,""),t.R7$(),t.Y8G("ngIf",o.isHeadOffice),t.R7$(),t.Y8G("value",o.duesInTab[e.content])("columns",o.dueCols)("globalFilterFields",o.filterFields)}}function x(n,l){1&n&&(t.j41(0,"p-tabPanel",3),t.DNE(1,X,8,5,"ng-template",4),t.k0s()),2&n&&t.Y8G("header",l.$implicit.title)}let Y=(()=>{class n{constructor(e,o,i,s){this.stockService=e,this.saleService=o,this.msgService=i,this.stgService=s,this.cols=[],this.dueCols=[],this.invoiceCols=[],this.filterFields=[],this.tabs=[],this.duesInTab={due15:[],overdue:[]},this.showAddPlanButton=!0,this.dueToday=0,this.dueByRegionToday={EAST:0,NORTH:0,SOUTH:0,WEST:0,"ALL INDIA":0},this.isHeadOffice=!1,"HO"===this.stgService.getUser().region&&(this.showAddPlanButton=!1,this.isHeadOffice=!0)}ngOnInit(){this.tabs=[{title:"Due in 15 days",content:"due15"},{title:"Overdue",content:"overdue"}],this.dueCols=[{field:"customerName",header:"Customer Name"},{field:"region",header:"Region"},{field:"invoiceNo",header:"Invoice #"},{field:"dueDate",header:"Due Dt"},{field:"totalDue",header:"Due amt"},{field:"schemeDiscount",header:"Scheme discounts"}],this.filterFields=this.dueCols.map(e=>e.field),(null==this.dues||0==this.dues.length)&&this.getDuesData()}showInvoice(e){this.currentInvoice=e,this.invoiceCols=[{field:"productName",header:"Item"},{field:"quantity",header:"Quantity"},{field:"baseRate",header:"Base Rate"}],this.saleService.getInvoiceForSale(e).subscribe(o=>{console.log(o)})}isInvoiceNo(e){return"invoiceNo"===e}getDuesData(){this.dueToday=0,this.duesInTab={due15:[],overdue:[]},this.dueByRegionToday={EAST:0,NORTH:0,SOUTH:0,WEST:0,"ALL INDIA":0},this.tabs.forEach(o=>this.duesInTab[o.content]=[]);let e=new Date;this.saleService.getSalesDueIn15Days().subscribe(o=>{this.dues=o,this.dues.forEach(i=>{this.duesInTab.due15.push(i),i.dueDate&&i.dueDate instanceof Date&&i.dueDate.getDate()===e.getDate()&&i.dueDate.getMonth()===e.getMonth()&&i.dueDate.getFullYear()===e.getFullYear()&&(this.dueToday=this.dueToday+i.totalDue,this.dueByRegionToday[i.region]=this.dueByRegionToday[i.region]+i.totalDue)})}),this.saleService.getOverdueSales().subscribe(o=>{o.forEach(i=>{this.duesInTab.overdue.push(i),i.dueDate&&i.dueDate instanceof Date&&i.dueDate.getDay()===e.getDate()&&i.dueDate.getMonth()===e.getMonth()&&i.dueDate.getFullYear()===e.getFullYear()&&(this.dueToday=this.dueToday+i.totalDue,this.dueByRegionToday[i.region]=this.dueByRegionToday[i.region]+i.totalDue)})})}onGlobalFilter(e,o){e.filterGlobal(o.target.value,"contains")}static{this.\u0275fac=function(o){return new(o||n)(t.rXU(T.Q),t.rXU(y),t.rXU(d.bg),t.rXU(N.n))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ng-component"]],features:[t.Jv_([d.bg,T.Q,y])],decls:4,vars:1,consts:[["dt",""],[1,"col-12"],[3,"header",4,"ngFor","ngForOf"],[3,"header"],["pTemplate","content"],[4,"ngIf"],["styleClass","p-datatable-sm p-datatable-gridlines","responsiveLayout","scroll",3,"value","columns","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Search...",1,"w-full","sm:w-auto",3,"input"],["pButton","","pRipple","","label","Export","icon","pi pi-upload",1,"block","p-button-help",3,"click"],[4,"ngFor","ngForOf"],[3,"label","link","onClick",4,"ngIf"],[3,"onClick","label","link"]],template:function(o,i){1&o&&(t.j41(0,"div",1),t.nrm(1,"p-toast"),t.j41(2,"p-tabView"),t.DNE(3,x,2,1,"p-tabPanel",2),t.k0s()()),2&o&&(t.R7$(3),t.Y8G("ngForOf",i.tabs))},dependencies:[c.Sq,c.bT,g.XI,d.Ei,p._f,p.$n,m.n,f.y8,_.S,r.JQ,r.Kp],styles:["td[_ngcontent-%COMP%]{padding:0%}"]})}}return n})(),A=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[v.iI.forChild([{path:"",component:Y}]),v.iI]})}}return n})(),H=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[c.MD,A,g.bG,C.YN,p.tm,m.Z,f.MB,_.u,R.kr,D.O3,F.P,r.fd]})}}return n})()}}]);